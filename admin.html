<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å MyZaim</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
    body {
        font-family: Arial, sans-serif;
        background: #f4f4f4;
        margin: 0;
        padding: 0;
    }
    .container {
        max-width: 700px;
        margin: 25px auto;
        background: #fff;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }
    h1 {
        margin-top: 0;
        text-align: center;
    }
    label {
        font-weight: bold;
        display: block;
        margin-top: 20px;
    }
    input, textarea {
        width: 100%;
        padding: 10px;
        font-size: 16px;
        margin-top: 5px;
        border: 1px solid #ccc;
        border-radius: 6px;
    }
    textarea {
        min-height: 60px;
    }

    button {
        width: 100%;
        padding: 14px;
        background: #2563eb;
        border: none;
        color: #fff;
        border-radius: 6px;
        margin-top: 30px;
        font-size: 18px;
        transition: 0.2s;
        cursor: pointer;
    }
    button:hover {
        background: #1e40af;
    }

    .benefit-item {
        background: #eee;
        padding: 10px;
        border-radius: 6px;
        margin-top: 10px;
    }
    
    .applications-btn {
        background: #10b981;
        margin-top: 15px;
    }
    .applications-btn:hover {
        background: #0da271;
    }
    
    .applications-container {
        display: none;
        margin-top: 30px;
        border-top: 2px solid #eee;
        padding-top: 20px;
    }
    
    .application-item {
        background: #f9f9f9;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 15px;
        position: relative;
    }
    
    .application-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
        padding-bottom: 10px;
        border-bottom: 1px solid #eee;
    }
    
    .application-id {
        background: #2563eb;
        color: white;
        padding: 3px 8px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: bold;
    }
    
    .application-date {
        color: #666;
        font-size: 12px;
    }
    
    .application-field {
        margin: 5px 0;
        display: flex;
    }
    
    .field-label {
        font-weight: bold;
        min-width: 100px;
        color: #555;
    }
    
    .field-value {
        flex: 1;
    }
    
    .status-new {
        background: #fef3c7;
        color: #92400e;
        padding: 3px 8px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: bold;
    }
    
    .status-processing {
        background: #dbeafe;
        color: #1e40af;
        padding: 3px 8px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: bold;
    }
    
    .status-completed {
        background: #d1fae5;
        color: #065f46;
        padding: 3px 8px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: bold;
    }
    
    .application-actions {
        margin-top: 10px;
        padding-top: 10px;
        border-top: 1px dashed #ddd;
        display: flex;
        justify-content: flex-end;
        gap: 10px;
    }
    
    .delete-btn {
        background: #ef4444;
        color: white;
        border: none;
        padding: 5px 10px;
        border-radius: 4px;
        font-size: 12px;
        cursor: pointer;
    }
    
    .delete-btn:hover {
        background: #dc2626;
    }
    
    .clear-all-btn {
        background: #f59e0b;
        margin-top: 10px;
    }
    
    .clear-all-btn:hover {
        background: #d97706;
    }
</style>
</head>

<body>
<div class="container">
    <h1>‚öô –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å MyZaim</h1>

    <label>GitHub Token</label>
<input id="token" type="text" placeholder="ghp_xxxxxxxxxxxxxxxxxxx" value="">

<label>GitHub Owner</label>
<input id="owner" type="text" placeholder="–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è" value="petrovicigor0">

<label>GitHub Repo</label>
<input id="repo" type="text" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è" value="my-microzaim-site">


    <button onclick="loadConfig()">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥</button>

    <div id="editor" style="display:none;">

        <label>Primary Color</label>
        <input id="primaryColor" type="color">

        <label>Secondary Color</label>
        <input id="secondaryColor" type="color">

        <label>–ó–∞–≥–æ–ª–æ–≤–æ–∫</label>
        <input id="heroTitle">

        <label>–ü–æ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫</label>
        <textarea id="heroSubtitle"></textarea>

        <label>–¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏</label>
        <input id="heroButtonText">

        <label>–¶–≤–µ—Ç –∫–Ω–æ–ø–∫–∏</label>
        <input id="heroButtonColor" type="color">

        <label>URL –±–∞–Ω–Ω–µ—Ä–∞</label>
        <input id="bannerUrl">
        
        <label>–í–∞–ª—é—Ç–∞</label>
    <select id="currency">
    <option value="MDL">–õ–µ–∏ (MDL)</option>
    <option value="RON">–†—É–º—ã–Ω–∏—è (RON)</option>
    <option value="RUB">–†—É–±–ª–∏ (RUB)</option>
    <option value="UAH">–ì—Ä–∏–≤–Ω—ã (UAH)</option>
    </select>


        <h2>–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞</h2>
        <div id="benefits"></div>

        <button onclick="saveConfig()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥</button>
        
        <!-- –ù–û–í–ê–Ø –ö–ù–û–ü–ö–ê –î–õ–Ø –ó–ê–Ø–í–û–ö -->
        <button class="applications-btn" onclick="showApplications()" id="showAppsBtn">üìã –ü–æ–∫–∞–∑–∞—Ç—å –∑–∞—è–≤–∫–∏</button>
        
        <!-- –ö–û–ù–¢–ï–ô–ù–ï–† –î–õ–Ø –û–¢–û–ë–†–ê–ñ–ï–ù–ò–Ø –ó–ê–Ø–í–û–ö -->
        <div class="applications-container" id="applicationsContainer">
            <h2>üìÑ –ó–∞—è–≤–∫–∏ –Ω–∞ –∑–∞–π–º—ã</h2>
            
            <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
            <div style="margin-bottom: 20px; display: flex; gap: 10px;">
                <button onclick="showApplications()" style="padding: 8px 15px; flex: 1;">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
                <button onclick="clearAllApplications()" class="clear-all-btn" style="padding: 8px 15px; flex: 1;">
                    üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –∑–∞—è–≤–∫–∏
                </button>
            </div>
            
            <div id="applicationsList"></div>
        </div>
        
    </div>
</div>

<script>
// –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
let currentToken = '';
let currentOwner = '';
let currentRepo = '';
let applicationsData = null;
let currentDataSha = '';

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∫–∏ Base64 UTF-8
function decodeBase64Utf8(base64) {
    const bytes = Uint8Array.from(atob(base64), c => c.charCodeAt(0));
    const decoder = new TextDecoder('utf-8');
    return decoder.decode(bytes);
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è –≤ Base64
function encodeToBase64(str) {
    return btoa(unescape(encodeURIComponent(str)));
}

async function loadConfig() {
    currentToken = document.getElementById("token").value.trim();
    currentOwner = document.getElementById("owner").value.trim();
    currentRepo  = document.getElementById("repo").value.trim();
    
    if (!currentToken || !currentOwner || !currentRepo) {
        alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è: —Ç–æ–∫–µ–Ω, owner –∏ repo!");
        return;
    }

    const url = `https://api.github.com/repos/${currentOwner}/${currentRepo}/contents/config.json`;

    const response = await fetch(url, {
        headers: { "Authorization": `Bearer ${currentToken}` }
    });

    if (!response.ok) {
        alert("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: –ø—Ä–æ–≤–µ—Ä—å —Ç–æ–∫–µ–Ω/—Ä–µ–ø–æ");
        return;
    }

    const file = await response.json();
    window.sha = file.sha;

    // –î–µ–∫–æ–¥–∏—Ä—É–µ–º Base64 –≤ UTF-8
    const configText = decodeBase64Utf8(file.content);
    const config = JSON.parse(configText);
    window.currentConfig = config;

    // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª—è –∞–¥–º–∏–Ω–∫–∏
    document.getElementById("primaryColor").value = config.primaryColor;
    document.getElementById("secondaryColor").value = config.secondaryColor;
    document.getElementById("heroTitle").value = config.heroTitle;
    document.getElementById("heroSubtitle").value = config.heroSubtitle;
    document.getElementById("heroButtonText").value = config.heroButtonText;
    document.getElementById("heroButtonColor").value = config.heroButtonColor;
    document.getElementById("bannerUrl").value = config.bannerUrl;
    document.getElementById("currency").value = config.currency || "MDL";

    const benefitsBlock = document.getElementById("benefits");
    benefitsBlock.innerHTML = "";
    config.benefits.forEach((b, i) => {
        benefitsBlock.innerHTML += `
            <div class="benefit-item">
                <label>–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                <input id="benefit_title_${i}" value="${b.title}">
                <label>–û–ø–∏—Å–∞–Ω–∏–µ</label>
                <textarea id="benefit_text_${i}">${b.text}</textarea>
            </div>
        `;
    });

    document.getElementById("editor").style.display = "block";
    document.getElementById("showAppsBtn").style.display = "block";
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∑–∞—è–≤–æ–∫
async function showApplications() {
    if (!currentToken || !currentOwner || !currentRepo) {
        alert("–°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –∫–æ–Ω—Ñ–∏–≥!");
        return;
    }
    
    try {
        const url = `https://api.github.com/repos/${currentOwner}/${currentRepo}/contents/data.json`;
        
        const response = await fetch(url, {
            headers: { "Authorization": `Bearer ${currentToken}` }
        });
        
        if (!response.ok) {
            if (response.status === 404) {
                document.getElementById("applicationsList").innerHTML = 
                    '<div class="application-item">–§–∞–π–ª data.json –Ω–µ –Ω–∞–π–¥–µ–Ω. –ó–∞—è–≤–æ–∫ –µ—â–µ –Ω–µ—Ç.</div>';
                document.getElementById("applicationsContainer").style.display = "block";
                return;
            }
            throw new Error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${response.status}`);
        }
        
        const file = await response.json();
        currentDataSha = file.sha; // –°–æ—Ö—Ä–∞–Ω—è–µ–º SHA –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
        const content = decodeBase64Utf8(file.content);
        applicationsData = JSON.parse(content);
        
        displayApplications(applicationsData);
        document.getElementById("applicationsContainer").style.display = "block";
        
    } catch (error) {
        console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞—è–≤–æ–∫:", error);
        document.getElementById("applicationsList").innerHTML = 
            `<div class="application-item" style="background:#fee;color:#c00;">
                –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞—è–≤–æ–∫: ${error.message}
            </div>`;
        document.getElementById("applicationsContainer").style.display = "block";
    }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∑–∞—è–≤–æ–∫
function displayApplications(data) {
    const container = document.getElementById("applicationsList");
    
    if (!data.applications || data.applications.length === 0) {
        container.innerHTML = '<div class="application-item">–ó–∞—è–≤–æ–∫ –ø–æ–∫–∞ –Ω–µ—Ç.</div>';
        return;
    }
    
    // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –¥–∞—Ç–µ (–Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É)
    const sortedApps = [...data.applications].sort((a, b) => {
        const dateA = new Date(a.timestamp || a.date || 0);
        const dateB = new Date(b.timestamp || b.date || 0);
        return dateB - dateA;
    });
    
    container.innerHTML = '';
    
    sortedApps.forEach((app, index) => {
        const appDate = new Date(app.timestamp || app.date || Date.now());
        const formattedDate = appDate.toLocaleString('ru-RU', {
            day: '2-digit',
            month: '2-digit',
            year: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
        });
        
        const status = app.status || '–Ω–æ–≤–∞—è';
        let statusClass = 'status-new';
        if (status.includes('–æ–±—Ä–∞–±–æ—Ç')) statusClass = 'status-processing';
        if (status.includes('–æ–¥–æ–±—Ä') || status.includes('–∑–∞–≤–µ—Ä—à')) statusClass = 'status-completed';
        
        // –°–æ–∑–¥–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –¥–ª—è –∑–∞—è–≤–∫–∏
        const appId = app.id || index;
        
        container.innerHTML += `
            <div class="application-item" id="app-${appId}">
                <div class="application-header">
                    <div>
                        <span class="application-id">#${app.id || index + 1}</span>
                        <span class="status ${statusClass}" style="margin-left: 10px;">${status}</span>
                    </div>
                    <div class="application-date">${formattedDate}</div>
                </div>
                
                <div class="application-field">
                    <div class="field-label">–ö–ª–∏–µ–Ω—Ç:</div>
                    <div class="field-value"><strong>${app.firstName || app.first_name || ''} ${app.lastName || app.last_name || ''}</strong></div>
                </div>
                
                <div class="application-field">
                    <div class="field-label">–ö–æ–Ω—Ç–∞–∫—Ç—ã:</div>
                    <div class="field-value">
                        üìß ${app.email || '–Ω–µ —É–∫–∞–∑–∞–Ω'} 
                        | üì± ${app.phone || '–Ω–µ —É–∫–∞–∑–∞–Ω'}
                    </div>
                </div>
                
                <div class="application-field">
                    <div class="field-label">–ó–∞—ë–º:</div>
                    <div class="field-value">
                        üí∞ ${app.amount || 0} ${app.currency || 'MDL'} 
                        –Ω–∞ ${app.days || 0} –¥–Ω–µ–π
                        | üéØ –ö –≤–æ–∑–≤—Ä–∞—Ç—É: ${app.total || app.total_amount || '0'}
                    </div>
                </div>
                
                ${app.source ? `
                <div class="application-field">
                    <div class="field-label">–ò—Å—Ç–æ—á–Ω–∏–∫:</div>
                    <div class="field-value">${app.source}</div>
                </div>` : ''}
                
                ${app.note ? `
                <div class="application-field">
                    <div class="field-label">–ó–∞–º–µ—Ç–∫–∞:</div>
                    <div class="field-value">${app.note}</div>
                </div>` : ''}
                
                <div class="application-actions">
                    <button class="delete-btn" onclick="deleteApplication(${appId})">
                        üóëÔ∏è –£–¥–∞–ª–∏—Ç—å —ç—Ç—É –∑–∞—è–≤–∫—É
                    </button>
                </div>
            </div>
        `;
    });
    
    // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
    const stats = `
        <div class="application-item" style="background:#e8f4fd;">
            <div style="text-align: center; font-weight: bold; margin-bottom: 10px;">
                üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
            </div>
            <div style="display: flex; justify-content: space-around; text-align: center;">
                <div>
                    <div style="font-size: 24px; font-weight: bold; color: #2563eb;">
                        ${sortedApps.length}
                    </div>
                    <div style="font-size: 12px; color: #666;">–≤—Å–µ–≥–æ –∑–∞—è–≤–æ–∫</div>
                </div>
                <div>
                    <div style="font-size: 24px; font-weight: bold; color: #10b981;">
                        ${sortedApps.filter(a => (a.status || '').includes('–Ω–æ–≤–∞—è')).length}
                    </div>
                    <div style="font-size: 12px; color: #666;">–Ω–æ–≤—ã—Ö</div>
                </div>
                <div>
                    <div style="font-size: 24px; font-weight: bold; color: #f59e0b;">
                        ${sortedApps.filter(a => (a.status || '').includes('–æ–±—Ä–∞–±–æ—Ç')).length}
                    </div>
                    <div style="font-size: 12px; color: #666;">–≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ</div>
                </div>
            </div>
        </div>
    `;
    
    container.insertAdjacentHTML('afterbegin', stats);
}

// –§—É–Ω–∫—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è –æ–¥–Ω–æ–π –∑–∞—è–≤–∫–∏
async function deleteApplication(appIdToDelete) {
    if (!applicationsData || !applicationsData.applications) {
        alert("–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è!");
        return;
    }
    
    if (!confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –∑–∞—è–≤–∫—É?")) {
        return;
    }
    
    try {
        // –ù–∞—Ö–æ–¥–∏–º –∏–Ω–¥–µ–∫—Å –∑–∞—è–≤–∫–∏
        const appIndex = applicationsData.applications.findIndex(app => 
            (app.id && app.id == appIdToDelete) || 
            applicationsData.applications.indexOf(app) == appIdToDelete
        );
        
        if (appIndex === -1) {
            alert("–ó–∞—è–≤–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!");
            return;
        }
        
        // –£–¥–∞–ª—è–µ–º –∑–∞—è–≤–∫—É –∏–∑ –º–∞—Å—Å–∏–≤–∞
        const deletedApp = applicationsData.applications.splice(appIndex, 1)[0];
        console.log("–£–¥–∞–ª–µ–Ω–∞ –∑–∞—è–≤–∫–∞:", deletedApp);
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
        await saveApplicationsData();
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
        displayApplications(applicationsData);
        
        alert("‚úÖ –ó–∞—è–≤–∫–∞ —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞!");
        
    } catch (error) {
        console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∑–∞—è–≤–∫–∏:", error);
        alert("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏: " + error.message);
    }
}

// –§—É–Ω–∫—Ü–∏—è –æ—á–∏—Å—Ç–∫–∏ –≤—Å–µ—Ö –∑–∞—è–≤–æ–∫
async function clearAllApplications() {
    if (!applicationsData || !applicationsData.applications || applicationsData.applications.length === 0) {
        alert("–ù–µ—Ç –∑–∞—è–≤–æ–∫ –¥–ª—è –æ—á–∏—Å—Ç–∫–∏!");
        return;
    }
    
    if (!confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –í–°–ï –∑–∞—è–≤–∫–∏ (${applicationsData.applications.length} —à—Ç.)? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!`)) {
        return;
    }
    
    try {
        // –°–æ–∑–¥–∞–µ–º –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ –∑–∞—è–≤–æ–∫
        applicationsData.applications = [];
        applicationsData.lastUpdated = Date.now();
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
        await saveApplicationsData();
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
        displayApplications(applicationsData);
        
        alert(`‚úÖ –í—Å–µ –∑–∞—è–≤–∫–∏ —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω—ã!`);
        
    } catch (error) {
        console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ –∑–∞—è–≤–æ–∫:", error);
        alert("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ: " + error.message);
    }
}

// –§—É–Ω–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∑–∞—è–≤–æ–∫ –≤ GitHub
async function saveApplicationsData() {
    if (!currentToken || !currentOwner || !currentRepo) {
        throw new Error("–ù–µ –∑–∞–¥–∞–Ω—ã –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ GitHub");
    }
    
    if (!applicationsData) {
        throw new Error("–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è");
    }
    
    const url = `https://api.github.com/repos/${currentOwner}/${currentRepo}/contents/data.json`;
    
    // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ
    const dataToSave = {
        ...applicationsData,
        lastUpdated: Date.now()
    };
    
    // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ JSON –∏ –∫–æ–¥–∏—Ä—É–µ–º –≤ Base64
    const jsonString = JSON.stringify(dataToSave, null, 2);
    const encodedContent = encodeToBase64(jsonString);
    
    const response = await fetch(url, {
        method: "PUT",
        headers: {
            "Authorization": `Bearer ${currentToken}`,
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            message: applicationsData.applications.length === 0 ? 
                "–û—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö –∑–∞—è–≤–æ–∫" : 
                `–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (–æ—Å—Ç–∞–ª–æ—Å—å ${applicationsData.applications.length} –∑–∞—è–≤–æ–∫)`,
            content: encodedContent,
            sha: currentDataSha // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π SHA
        })
    });
    
    if (!response.ok) {
        const errorData = await response.json().catch(() => ({}));
        throw new Error(errorData.message || "–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è");
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º SHA –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
    const result = await response.json();
    currentDataSha = result.content.sha;
    
    return true;
}

async function saveConfig() {
    const token = document.getElementById("token").value.trim();
    const owner = document.getElementById("owner").value.trim();
    const repo  = document.getElementById("repo").value.trim();

    let updated = { ...window.currentConfig };

    updated.primaryColor = document.getElementById("primaryColor").value;
    updated.secondaryColor = document.getElementById("secondaryColor").value;
    updated.heroTitle = document.getElementById("heroTitle").value;
    updated.heroSubtitle = document.getElementById("heroSubtitle").value;
    updated.heroButtonText = document.getElementById("heroButtonText").value;
    updated.heroButtonColor = document.getElementById("heroButtonColor").value;
    updated.bannerUrl = document.getElementById("bannerUrl").value;
    updated.currency = document.getElementById("currency").value;

    updated.benefits = updated.benefits.map((b, i) => ({
        title: document.getElementById(`benefit_title_${i}`).value,
        text: document.getElementById(`benefit_text_${i}`).value
    }));

    const url = `https://api.github.com/repos/${owner}/${repo}/contents/config.json`;

    // –ö–æ–¥–∏—Ä—É–µ–º UTF-8 –≤ Base64 –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
    const content = btoa(unescape(encodeURIComponent(JSON.stringify(updated, null, 2))));

    const response = await fetch(url, {
        method: "PUT",
        headers: {
            "Authorization": `Bearer ${token}`,
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            message: "Update config.json",
            content: content,
            sha: window.sha
        })
    });

    if (response.ok) {
        alert("–ö–æ–Ω—Ñ–∏–≥ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω—ë–Ω!");
    } else {
        alert("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è!");
    }
}
</script>

</body>
</html>
